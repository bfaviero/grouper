<html>
  <head>
    <link rel="stylesheet" type="text/css" href="styles.css"/>
    <script src="http://192.168.186.153:3000/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.7.1.js" type="text/javascript"></script>
    <script type="text/javascript">

        var socket = io.connect('http://192.168.186.153:3000');

        socket.on('msg', function(data) {
            var msg = JSON.parse(data);
            appendMsg(msg);
        });

        socket.on('init', function(data) {
            var messages = JSON.parse(data)
            for (i in messages)
                appendMsg(messages[i])
        });

        function appendMsg(msg) {
            $('#msgs').append(function() {
                var div = $('<div>');
                div.html('<b>' + msg.username + ':</b> ' + msg.message);
                return div;
            });
            $('#msgs')[0].scrollTop = $('#msgs')[0].scrollHeight;
        }

        function sendMsg() {
            var msg = {};
            $.each($('#chat').serializeArray(), function(i,v) {
                msg[v.name] = v.value;
            });
            $("#msg").val("");
            appendMsg(msg);
            socket.emit('msg', JSON.stringify(msg));
        }
    </script>


</head>
<body>
    <div>
        <p class="chat-title" onclick="javascript: toggleChat();">Real Time Chat</p>
        <div id="msgs"></div>
        <div id="form">
            <form id="chat" onsubmit="sendMsg(); return false;">
                <label for="username">Username: </label><input name="username" type="text"><br/>
                <label for="msg"> Message: </label><input id="msg" type="text" name="message"/><br/>
                <input type="submit"/>
            </form>
        </div>
    </div>
<section id="wrapper">
 
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <article>
      <p><span id="status">Please wait whilst we try to locate you...</span></p>
    </article>
<script>
function success(position) {
  var s = document.querySelector('#status');
   
  if (s.className == 'success') {
    return;
  }
   
  s.innerHTML = "found you!";
  s.className = 'success';
   
  var mapcanvas = document.createElement('div');
  mapcanvas.id = 'mapcanvas';
  mapcanvas.style.height = '400px';
  mapcanvas.style.width = '560px';
     
  document.querySelector('article').appendChild(mapcanvas);
   
  var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
  var latlng2 = new google.maps.LatLng(42.361858,-71.091177);
  var myOptions = {
    zoom: 15,
    center: latlng,
    mapTypeControl: true,
    navigationControlOptions: {style: google.maps.NavigationControlStyle.SMALL},
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };

  var map = new google.maps.Map(document.getElementById("mapcanvas"), myOptions);
   
  var marker = new google.maps.Marker({
      position: latlng,
      map: map,
      title:"You are here!"
  });
 var pinImage = new google.maps.MarkerImage("http://www.google.com/intl/en_us/mapfiles/ms/micons/blue-dot.png");
  var participant = new google.maps.Marker({
      position: latlng2,
      map: map,
      icon: pinImage,
      pinColor:"#00FFFF",
      title:"You are here3!"
  });
var grpCircle= new google.maps.Circle({
	center:latlng,
	radius:200,
	strokeColor:"",
	strokeOpacity:0.8,
	strokeWeight:2,
	fillColor:"#0000FF",
  	fillOpacity:0.1
  });
grpCircle.setMap(map);
}
 
function error(msg) {
  var s = document.querySelector('#status');
  s.innerHTML = typeof msg == 'string' ? msg : "failed";
  s.className = 'fail';
   
  // console.log(arguments);
}
 
if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(success, error);
} else {
  error('not supported');
}
 
</script>
</section>

<script language="javascript">
document.write (position.coords.latitude, position.coords.longitude);

</script>

</body>
</html>
